{% extends 'base.html'%}

{% block head %}

{% endblock %}


{% block body %}

<div class="content">
    <h1 style='text-align: center'> Expenses </h1>

    <div class="section-header">
        <h2>Welcome to Your Expenses Tracker, {{ current_user.username }}!</h2>
        <form action="/logout" method="POST" style="margin: 0; padding: 0; background: none;">
            <button type="submit">Logout</button>
        </form>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="model-status">
        {% if model_trained %}
            <p> AI model is trained and ready to use</p>
        {% else %}
            <p>AI model is not trained yet. Add at least 10 training examples.</p>
            <p>Current training examples: {{ training_count|default(0) }} / 10 needed </p>
        {% endif %}
    </div>

    {% if expenses|length < 1 %}
    <h4 style="text-align:center">There are no expenses. Add one below</h4>
    {% else %}
    <table>
        <tr>
            <th>Expense</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Added</th>
            <th>Actions</th>
        </tr>

        {% for expense in expenses %}

        <tr>
            <td>{{ expense.content }}</td>

            <td>{{ expense.category }}</td>

            <td>${{'%.2f' % expense.amount }}

            <td>{{ expense.date_created.date() }}</td>                                                                                                                                                                                                                                                                            
            <td>
                <a href="/delete/{{expense.id}}">Delete</a>
                <br>
                <a href="/update/{{expense.id}}">Update</a>
            </td>
        </tr>
        {% endfor %}

    </table>
    {% endif %}

    <form action="/" method="POST">

        <label for="content"> Expense </label>
        <input type="text" name="content" id="content" placeholder="Expense" required>

        <label for="category"> Category </label>
        <select name="category" id="category" required>
            <option value="Food">Food</option>
            <option value="Transportation">Transportation</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Bills">Bills</option>
            <option value="Health">Health</option>
            <option value="Education">Education</option>
            <option value="Shopping">Shopping</option>
            <option value="Rent">Rent</option>
            <option value="Utilities">Utilities</option>
            <option value="Insurance">Insurance</option>
            <option value="Gifts">Gifts</option>
            <option value="Travel">Travel</option>
            <option value="Subscriptions">Subscriptions</option>
            <option value="Taxes">Taxes</option>
            <option value="Loans">Loans</option>
            <option value="Entertainment/Leisure">Entertainment/Leisure</option>
            <option value="Sports">Sports</option>
            <option value="Other">Other</option>
        </select>
        

        <label for="amount"> Amount </label>
        <input type="number" name="amount" id="amount" step="0.01" placeholder="Amount" required>
        
        <input type="submit" value="Add Expense">
    </form>

    <div class="ai-section">
        <h3>Train AI model </h3>
        <p>Help the AI learn to categorize your expenses automatically</p>

        <form action="/train_model" method="POST">
            <label for="expense_description">Expense Description</label>
            <input type="text" name="expense_description" id="expense_description" placeholder="Enter expense description (e.g., 'Bus ticket')" required>

            <label for="expense_category">Category</label>
            <select name="expense_category" id="expense_category" required>
                <option value="Food">Food</option>
                <option value="Transportation">Transportation</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Bills">Bills</option>
                <option value="Other">Other</option>
            </select>

            <input type="submit" value="Add Training Example">
        </form>
    </div>
    <a href="{{ url_for('model_stats') }}" class="button">View AI Model Statistics</a>

    <div class="ai-predict-section">
        <h3>Quick Add with AI</h3>
        <p>Let the AI predict the category for a new expense</p>

        <form action="/predict_category" method="POST">
            <label for="test_description">Expense Description</label>
            <input type="text" name="test_description" id="test_description" placeholder="Enter expense description (e.g., 'Movie tickets')" required>

            <label for="amount">Amount</label>
            <input type="number" name="amount" id="predict_amount" step="0.01" placeholder="Amount" value="0.00" required>

            <input type="submit" value="Add with AI prediction" {% if not model_trained %}disabled{% endif %}>
            {% if not model_trained %}
            <p><small>Train the model first to enable this feature</small></p>
            {% endif %}
        </form>
    </div>
</div>

{% endblock %}